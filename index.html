---
layout: default
---

<!-- Tabs for Section Navigation -->
<ul class="tabs">
  <li><a href="#" data-tab="social-cultural">Social/Cultural</a></li>
  <li><a href="#" data-tab="domestic">Domestic Affairs</a></li>
  <li><a href="#" data-tab="foreign-affairs">Foreign Affairs</a></li>
</ul>

<!-- Social/Cultural Section -->
<div id="social-cultural" class="tab-content">
  <h2>Social/Cultural</h2>
  <div id="socialPosts"></div>
</div>

<!-- Domestic Affairs Section -->
<div id="domestic" class="tab-content" style="display: none;">
  <h2>Domestic Affairs</h2>
  <div id="domesticPosts"></div>
</div>

<!-- Foreign Affairs Section -->
<div id="foreign-affairs" class="tab-content" style="display: none;">
  <h2>Foreign Affairs</h2>
  <div id="foreignPosts"></div>
</div>

<!-- Add a form for users to submit new posts -->
<div class="post-form">
  <h2>Add a New Post</h2>
  <form id="postForm">
    <input type="text" id="title" placeholder="Post Title" required />
    <textarea id="content" placeholder="Post Content" required></textarea>
    <select id="category">
      <option value="social-cultural">Social/Cultural</option>
      <option value="domestic">Domestic Affairs</option>
      <option value="foreign-affairs">Foreign Affairs</option>
    </select>
    <button type="submit">Submit Post</button>
  </form>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-analytics.js"></script>

<script>
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDdvPz4MqhcaR5AxqflgIy7EE4jRvzNn5E",
    authDomain: "perceptos-website.firebaseapp.com",
    projectId: "perceptos-website",
    storageBucket: "perceptos-website.appspot.com",
    messagingSenderId: "348493325500",
    appId: "1:348493325500:web:77089e867aa9f256d3dcb9",
    measurementId: "G-88LHK6VWD7"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  firebase.analytics();

  // Function to add a new post to Firestore
  async function addPost(title, content, category) {
    try {
      await db.collection('posts').add({
        title: title,
        content: content,
        category: category, // Save the category with the post
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      console.log('Post added successfully!');
      displayPosts(); // Refresh posts after adding
    } catch (error) {
      console.error('Error adding post: ', error);
    }
  }

  // Function to add a comment to a post
  async function addComment(postId, content) {
    try {
      await db.collection('posts').doc(postId).collection('comments').add({
        content: content,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      console.log('Comment added successfully!');
      displayPosts(); // Refresh posts after adding
    } catch (error) {
      console.error('Error adding comment: ', error);
    }
  }

  // Function to display posts from Firestore
  async function displayPosts() {
    const socialPosts = document.getElementById('socialPosts');
    const domesticPosts = document.getElementById('domesticPosts');
    const foreignPosts = document.getElementById('foreignPosts');

    // Clear containers before appending new posts
    socialPosts.innerHTML = '';
    domesticPosts.innerHTML = '';
    foreignPosts.innerHTML = '';

    try {
      const querySnapshot = await db.collection('posts').orderBy('timestamp', 'desc').get();
      querySnapshot.forEach(async (doc) => {
        const post = doc.data();
        const postId = doc.id;
        const postHTML = `
          <div class="post">
            <h2>${post.title}</h2>
            <p>${post.content}</p>
            <a href="#" class="toggle-comments" data-id="${postId}">...</a>
            <div class="comments-section" id="comments-${postId}" style="display: none;"></div>
            <form class="add-comment-form" data-id="${postId}">
              <textarea placeholder="Add a comment"></textarea>
              <button type="submit">Submit</button>
            </form>
          </div>`;

        if (post.category === 'social-cultural') {
          socialPosts.innerHTML += postHTML;
        } else if (post.category === 'domestic') {
          domesticPosts.innerHTML += postHTML;
        } else if (post.category === 'foreign-affairs') {
          foreignPosts.innerHTML += postHTML;
        }

        // Fetch and display comments for this post
        await displayComments(postId);
      });
    } catch (error) {
      console.error('Error fetching posts: ', error);
    }
  }

  // Function to display comments for a post
  async function displayComments(postId) {
    const commentsSection = document.getElementById(`comments-${postId}`);
    commentsSection.innerHTML = ''; // Clear existing comments

    try {
      const commentsSnapshot = await db.collection('posts').doc(postId).collection('comments').orderBy('timestamp', 'desc').get();
      commentsSnapshot.forEach((commentDoc) => {
        const comment = commentDoc.data();
        commentsSection.innerHTML += `<div class="comment">${comment.content}</div>`;
      });
    } catch (error) {
      console.error('Error fetching comments: ', error);
    }
  }

  // Function to handle tab switching
  document.querySelectorAll('.tabs a').forEach(tab => {
    tab.addEventListener('click', (e) => {
      e.preventDefault();

      const selectedTab = e.target.getAttribute('data-tab');
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
      // Show the selected tab's content
      document.getElementById(selectedTab).style.display = 'block';
    });
  });

  // Handle comment visibility toggle
  document.addEventListener('click', (e) => {
    if (e.target.classList.contains('toggle-comments')) {
      e.preventDefault();
      const postId = e.target.getAttribute('data-id');
      const commentsSection = document.getElementById(`comments-${postId}`);
      commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
    }
  });

  // Handle form submission for new posts
  document.getElementById('postForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const title = document.getElementById('title').value;
    const content = document.getElementById('content').value;
    const category = document.getElementById('category').value; // Get category
    await addPost(title, content, category);

    // Clear form fields
    document.getElementById('title').value = '';
    document.getElementById('content').value = '';
  });

  // Handle form submission for new comments
  document.addEventListener('submit', async (e) => {
    if (e.target.classList.contains('add-comment-form')) {
      e.preventDefault();
      const postId = e.target.getAttribute('data-id');
      const commentContent = e.target.querySelector('textarea').value;
      await addComment(postId, commentContent);

      // Clear comment field
      e.target.querySelector('textarea').value = '';
    }
  });

  // Display posts on page load
  displayPosts();
</script>

